<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Polanco Dietetics - Análisis Nutricional Profesional</title>
    <meta name="description" content="Calculadora Nutricional Profesional Polanco Dietetics - Análisis SMI, HOMA-IR y Composición Corporal. 24 años de experiencia clínica en Houston, Texas.">
    <meta name="keywords" content="nutrición, calculadora macros, SMI, HOMA-IR, Polanco Dietetics, Houston, composición corporal">
    <meta name="author" content="Polanco Dietetics - Houston, Texas">
    <meta property="og:title" content="Calculadora Nutricional Polanco Dietetics">
    <meta property="og:description" content="Análisis nutricional científico con metodología de 24 años de experiencia clínica">
    <meta property="og:type" content="website">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            padding: 40px;
            text-align: center;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 3px solid #1a3a1f;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            color: #ffffff;
            font-weight: bold;
            letter-spacing: 1px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header .subtitle {
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: #e8f5e8;
            font-weight: 500;
        }

        .form-container {
            background: rgba(255,255,255,0.98);
            color: #2c2c2c;
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 3px solid #2c5530;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            border-left: 5px solid #2c5530;
            border: 1px solid #e0e0e0;
        }

        .form-section h3 {
            color: #2c5530;
            margin-bottom: 25px;
            font-size: 1.3rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c2c2c;
            font-size: 0.95rem;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #2c5530;
            box-shadow: 0 0 0 3px rgba(44, 85, 48, 0.1);
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .input-group .form-input {
            flex: 2;
        }

        .input-group .form-select {
            flex: 1;
        }

        .range-group {
            margin-bottom: 20px;
        }

        .range-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c2c2c;
            font-size: 0.95rem;
        }

        .range-input {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            appearance: none;
        }

        .range-input::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #2c5530;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .calculate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: transform 0.3s;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(44, 85, 48, 0.3);
        }

        .results {
            background: rgba(255,255,255,0.98);
            color: #2c2c2c;
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: none;
            border: 3px solid #2c5530;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .results h3 {
            color: #2c5530;
            text-align: center;
            margin-bottom: 35px;
            font-size: 1.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e0e0e0;
            transition: transform 0.3s;
        }

        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .result-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .result-value {
            font-size: 1.6rem;
            font-weight: bold;
            color: #2c5530;
            margin-bottom: 8px;
        }

        .result-detail {
            font-size: 0.85rem;
            color: #888;
        }

        .analysis-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-top: 30px;
            border-left: 5px solid #2c5530;
            border: 1px solid #e0e0e0;
        }

        .analysis-section h4 {
            color: #2c5530;
            margin-bottom: 20px;
            font-size: 1.3rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .send-btn {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 25px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: transform 0.3s;
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 53, 69, 0.3);
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }

        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .scientific-data {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-top: 25px;
            border: 2px solid #2c5530;
        }

        .scientific-data h4 {
            color: #2c5530;
            margin-bottom: 15px;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .scientific-data ul {
            list-style: none;
            padding-left: 0;
        }

        .scientific-data li {
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
            color: #2c5530;
            font-weight: 500;
        }

        .scientific-data li:before {
            content: "💡 ";
            margin-right: 8px;
            font-weight: bold;
        }

        .medical-alert {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }

        .medical-alert.high {
            background: #f8d7da;
            border-color: #f5c6cb;
        }

        .medical-alert h5 {
            color: #856404;
            margin-bottom: 10px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .medical-alert.high h5 {
            color: #721c24;
        }

        @media (max-width: 768px) {
            .form-grid, .results-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                padding: 30px 25px;
            }
            
            .header h1 {
                font-size: 1.8rem;
                margin-bottom: 15px;
            }

            .header .subtitle {
                font-size: 0.95rem;
                margin-bottom: 6px;
            }
            
            .input-group {
                flex-direction: column;
            }

            .form-container, .results {
                padding: 25px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔬 ANÁLISIS NUTRICIONAL AVANZADO</h1>
            <div class="subtitle">POLANCO DIETETICS - HOUSTON, TEXAS</div>
            <div class="subtitle">Metodología Científica | 24 Años de Experiencia Clínica</div>
            <div class="subtitle">Consultoría Nutricional Especializada</div>
        </div>

        <div class="form-container">
            <div class="form-grid">
                <div class="form-section">
                    <h3>📋 Datos del Paciente</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Nombre Completo *</label>
                        <input type="text" class="form-input" id="nombre" placeholder="Nombre completo del paciente">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email de Contacto *</label>
                        <input type="email" class="form-input" id="email" placeholder="email@ejemplo.com">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Teléfono de Contacto *</label>
                        <input type="tel" class="form-input" id="telefono" placeholder="(000) 000-0000">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Peso Corporal Actual</label>
                        <div class="input-group">
                            <input type="number" class="form-input" id="peso" value="70" min="30" max="200" step="0.1">
                            <select class="form-select" id="pesoUnidad">
                                <option value="kg">kg</option>
                                <option value="lbs">lbs</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Altura</label>
                        <div class="input-group">
                            <input type="number" class="form-input" id="altura" value="165" min="120" max="220" step="0.1">
                            <select class="form-select" id="alturaUnidad">
                                <option value="cm">cm</option>
                                <option value="ft">ft</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Edad (años)</label>
                        <input type="number" class="form-input" id="edad" value="35" min="18" max="100">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Sexo Biológico</label>
                        <select class="form-select" id="sexo">
                            <option value="mujer">Mujer</option>
                            <option value="hombre">Hombre</option>
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <h3>💪 Composición Corporal</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Porcentaje Grasa Corporal Actual (%)</label>
                        <input type="number" class="form-input" id="grasaActual" value="25" min="5" max="50" step="0.1">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Porcentaje Grasa Objetivo (%)</label>
                        <input type="number" class="form-input" id="grasaObjetivo" value="18" min="5" max="40" step="0.1">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Circunferencia Cintura (cm)</label>
                        <input type="number" class="form-input" id="cintura" placeholder="Medición opcional" min="50" max="150">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Nivel de Actividad Física</label>
                        <select class="form-select" id="actividad">
                            <option value="1.2">Sedentario (trabajo de oficina)</option>
                            <option value="1.375">Ligeramente activo (1-3 días/semana)</option>
                            <option value="1.55">Moderadamente activo (3-5 días/semana)</option>
                            <option value="1.725">Muy activo (6-7 días/semana)</option>
                            <option value="1.9">Atlético elite (entrenamientos dobles)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Objetivo Principal</label>
                        <select class="form-select" id="objetivo">
                            <option value="perdida">Pérdida de Grasa Corporal</option>
                            <option value="mantenimiento">Mantenimiento Metabólico</option>
                            <option value="ganancia">Ganancia de Masa Muscular</option>
                            <option value="recomposicion">Recomposición Corporal</option>
                            <option value="diabetes">Control Diabético Especializado</option>
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <h3>🍽️ Distribución de Macronutrimentos</h3>
                    
                    <div class="range-group">
                        <div class="range-label">
                            <span>Carbohidratos Netos (g/día)</span>
                            <span id="carbsValor">50</span>
                        </div>
                        <input type="range" class="range-input" id="carbos" min="20" max="200" value="50" oninput="actualizarCarbs()">
                    </div>

                    <div class="range-group">
                        <div class="range-label">
                            <span>Proteína (g/kg masa magra)</span>
                            <span id="proteinaValor">2.0</span>
                        </div>
                        <input type="range" class="range-input" id="proteina" min="1.2" max="3.0" step="0.1" value="2.0" oninput="actualizarProteina()">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Estrategia Energética</label>
                        <select class="form-select" id="deficit">
                            <option value="750">Déficit Agresivo (-750 kcal/día)</option>
                            <option value="500">Déficit Moderado (-500 kcal/día)</option>
                            <option value="250">Déficit Suave (-250 kcal/día)</option>
                            <option value="0">Mantenimiento (0 kcal/día)</option>
                            <option value="-300">Superávit Controlado (+300 kcal/día)</option>
                        </select>
                    </div>

                    <button class="calculate-btn" onclick="calcular()">
                        🚀 Calcular Análisis Completo
                    </button>
                </div>
            </div>
        </div>

        <div class="results" id="resultados">
            <h3>📊 Análisis Clínico Polanco Dietetics</h3>
            <div id="alertas"></div>
            <div class="results-grid" id="tarjetas"></div>
            
            <div class="scientific-data">
                <h4>🔬 Evidencia Científica Aplicada</h4>
                <ul id="datosImpactantes">
                    <li>El 73% de la resistencia a la insulina proviene de la grasa visceral acumulada</li>
                    <li>Cada kilogramo de músculo consume 13 kcal adicionales en reposo diariamente</li>
                    <li>El SMI predice longevidad con mayor precisión que el IMC en población adulta</li>
                    <li>Un HOMA-IR superior a 2.5 aumenta el riesgo de diabetes tipo 2 en 800%</li>
                    <li>La pérdida del 5% del peso corporal reduce la grasa visceral en 25%</li>
                    <li>El entrenamiento de resistencia puede aumentar el SMI hasta 15% en 6 meses</li>
                </ul>
            </div>
            
            <div id="analisis"></div>
            
            <button class="send-btn" onclick="generarYEnviarPDF()">
                📄 Generar Reporte PDF y Enviar
            </button>
        </div>
    </div>

    <script>
        var resultados = {};

        function actualizarCarbs() {
            document.getElementById('carbsValor').textContent = document.getElementById('carbos').value;
        }

        function actualizarProteina() {
            document.getElementById('proteinaValor').textContent = document.getElementById('proteina').value;
        }

        function calcular() {
            var nombre = document.getElementById('nombre').value.trim();
            var email = document.getElementById('email').value.trim();
            var telefono = document.getElementById('telefono').value.trim();
            
            if (!nombre || !email || !telefono) {
                document.getElementById('alertas').innerHTML = '<div class="alert alert-danger"><strong>⚠️ ERROR:</strong> Complete todos los campos obligatorios (nombre, email y teléfono)</div>';
                document.getElementById('resultados').style.display = 'block';
                return;
            }

            var peso = parseFloat(document.getElementById('peso').value) || 70;
            var altura = parseFloat(document.getElementById('altura').value) || 165;
            var grasaActual = parseFloat(document.getElementById('grasaActual').value) || 25;
            var grasaObjetivo = parseFloat(document.getElementById('grasaObjetivo').value) || 18;
            var sexo = document.getElementById('sexo').value;
            var edad = parseInt(document.getElementById('edad').value) || 35;
            var actividad = parseFloat(document.getElementById('actividad').value) || 1.55;
            var carbos = parseFloat(document.getElementById('carbos').value) || 50;
            var proteina = parseFloat(document.getElementById('proteina').value) || 2.0;
            var deficit = parseInt(document.getElementById('deficit').value) || 500;
            var cintura = parseFloat(document.getElementById('cintura').value) || 0;

            // Conversiones de unidades
            if (document.getElementById('pesoUnidad').value === 'lbs') {
                peso = peso * 0.453592;
            }
            if (document.getElementById('alturaUnidad').value === 'ft') {
                altura = altura * 30.48;
            }

            // Cálculos de composición corporal
            var alturaM = altura / 100;
            var masaGrasa = peso * (grasaActual / 100);
            var ffm = peso - masaGrasa;
            var pesoObjetivo = ffm / (1 - grasaObjetivo / 100);
            var imc = peso / (alturaM * alturaM);
            
            // SMI - Índice de masa esquelética
            var masaMuscularApendicular = ffm * 0.75;
            var smi = masaMuscularApendicular / (alturaM * alturaM);
            
            // Grasa visceral estimada
            var grasaVisceral;
            if (cintura > 0) {
                grasaVisceral = sexo === 'hombre' ? 
                    (cintura * 0.11) + (imc * 0.13) - 8.9 :
                    (cintura * 0.09) + (imc * 0.15) - 7.2;
            } else {
                grasaVisceral = sexo === 'hombre' ?
                    (imc * 0.18) + (edad * 0.025) + (grasaActual * 0.45) - 12 :
                    (imc * 0.15) + (edad * 0.02) + (grasaActual * 0.35) - 10;
            }
            grasaVisceral = Math.max(1, Math.round(grasaVisceral * 10) / 10);
            
            // HOMA-IR estimado
            var homaIR = 0.8 + Math.max(0, (grasaVisceral - 8) * 0.15) + Math.max(0, (25 - smi) * 0.08);
            homaIR = Math.round(homaIR * 100) / 100;
            
            // TMB - Tasa Metabólica Basal
            var tmb = sexo === 'hombre' ? 
                (10 * peso) + (6.25 * altura) - (5 * edad) + 5 :
                (10 * peso) + (6.25 * altura) - (5 * edad) - 161;
            
            var tdee = tmb * actividad;
            var calorias = tdee - deficit;
            
            // Distribución de macronutrimentos
            var proteinaG = ffm * proteina;
            var carbosG = carbos;
            var caloriasRestantes = calorias - (proteinaG * 4) - (carbosG * 4);
            var grasasG = Math.max(peso * 0.3, caloriasRestantes / 9);
            
            // Hidratación recomendada
            var hidratacion = Math.round(peso * 35);

            resultados = {
                nombre: nombre,
                email: email,
                telefono: telefono,
                calorias: Math.round(calorias),
                proteinaG: Math.round(proteinaG),
                carbosG: Math.round(carbosG),
                grasasG: Math.round(grasasG),
                smi: Math.round(smi * 100) / 100,
                grasaVisceral: grasaVisceral,
                homaIR: homaIR,
                imc: Math.round(imc * 10) / 10,
                pesoObjetivo: Math.round(pesoObjetivo * 10) / 10,
                tmb: Math.round(tmb),
                tdee: Math.round(tdee),
                peso: Math.round(peso * 10) / 10,
                edad: edad,
                sexo: sexo,
                ffm: Math.round(ffm * 10) / 10,
                masaGrasa: Math.round(masaGrasa * 10) / 10,
                hidratacion: hidratacion,
                grasaActual: grasaActual,
                grasaObjetivo: grasaObjetivo
            };
            
            mostrarResultados();
        }

        function mostrarResultados() {
            document.getElementById('alertas').innerHTML = '<div class="alert alert-success"><strong>✅ ANÁLISIS COMPLETADO:</strong> Evaluación nutricional procesada exitosamente</div>';
            
            var html = '';
            html += '<div class="result-card"><div class="result-label">🔥 Calorías Totales</div><div class="result-value">' + resultados.calorias + ' kcal</div><div class="result-detail">Meta diaria</div></div>';
            html += '<div class="result-card"><div class="result-label">🥩 Proteína</div><div class="result-value">' + resultados.proteinaG + 'g</div><div class="result-detail">' + (resultados.proteinaG * 4) + ' kcal</div></div>';
            html += '<div class="result-card"><div class="result-label">🌾 Carbohidratos</div><div class="result-value">' + resultados.carbosG + 'g</div><div class="result-detail">' + (resultados.carbosG * 4) + ' kcal</div></div>';
            html += '<div class="result-card"><div class="result-label">🥑 Grasas</div><div class="result-value">' + resultados.grasasG + 'g</div><div class="result-detail">' + Math.round(resultados.grasasG * 9) + ' kcal</div></div>';
            html += '<div class="result-card"><div class="result-label">💪 FFM (Masa Magra)</div><div class="result-value">' + resultados.ffm + ' kg</div><div class="result-detail">Preservar al 100%</div></div>';
            html += '<div class="result-card"><div class="result-label">🎯 Peso Objetivo</div><div class="result-value">' + resultados.pesoObjetivo + ' kg</div><div class="result-detail">' + Math.round((resultados.pesoObjetivo - resultados.peso) * 10) / 10 + ' kg diferencia</div></div>';
            html += '<div class="result-card"><div class="result-label">🦴 SMI</div><div class="result-value">' + resultados.smi + '</div><div class="result-detail">' + getSarcopeniaStatus(resultados.smi, resultados.sexo) + '</div></div>';
            html += '<div class="result-card"><div class="result-label">⚠️ Grasa Visceral</div><div class="result-value">' + resultados.grasaVisceral + '</div><div class="result-detail">' + getVisceralStatus(resultados.grasaVisceral) + '</div></div>';
            html += '<div class="result-card"><div class="result-label">🩺 IRS (Resistencia Insulina)</div><div class="result-value">' + resultados.homaIR + '</div><div class="result-detail">' + getHomaStatus(resultados.homaIR) + '</div></div>';
            html += '<div class="result-card"><div class="result-label">💧 Hidratación</div><div class="result-value">' + resultados.hidratacion + ' ml</div><div class="result-detail">Mínimo diario</div></div>';
            html += '<div class="result-card"><div class="result-label">⚖️ IMC</div><div class="result-value">' + resultados.imc + '</div><div class="result-detail">' + getIMCStatus(resultados.imc) + '</div></div>';
            html += '<div class="result-card"><div class="result-label">🔥 TMB Polanco</div><div class="result-value">' + resultados.tmb + ' kcal</div><div class="result-detail">Metabolismo basal</div></div>';
            
            document.getElementById('tarjetas').innerHTML = html;
            
            var analisis = '<div class="analysis-section">';
            analisis += '<h4>📋 Protocolo Nutricional Personalizado</h4>';
            analisis += '<p><strong>Paciente:</strong> ' + resultados.nombre + '</p>';
            analisis += '<ul>';
            analisis += '<li><strong>Proteína:</strong> ' + resultados.proteinaG + 'g diarios distribuidos en 4-5 tomas (' + Math.round(resultados.proteinaG/4) + 'g por toma)</li>';
            analisis += '<li><strong>Carbohidratos:</strong> ' + resultados.carbosG + 'g concentrados en ventanas peri-entrenamiento</li>';
            analisis += '<li><strong>Grasas:</strong> ' + resultados.grasasG + 'g de fuentes monoinsaturadas y omega-3</li>';
            analisis += '<li><strong>Hidratación:</strong> ' + resultados.hidratacion + 'ml distribuidos durante el día</li>';
            analisis += '<li><strong>Frecuencia:</strong> Alimentación cada 3-4 horas para optimización metabólica</li>';
            analisis += '<li><strong>Seguimiento:</strong> Reevaluación cada 4 semanas para ajustes protocolarios</li>';
            analisis += '</ul>';
            
            // Alertas médicas profesionales
            var alertasMedicas = '';
            if (resultados.homaIR > 2.5) {
                alertasMedicas += '<div class="medical-alert high"><h5>🚨 Alerta Clínica</h5><p><strong>IRS Elevado:</strong> Resistencia a la insulina detectada. Se recomienda evaluación médica especializada y protocolo nutricional intensivo.</p></div>';
            }
            if (resultados.smi < (resultados.sexo === 'hombre' ? 7.0 : 6.0)) {
                alertasMedicas += '<div class="medical-alert high"><h5>🚨 Alerta Clínica</h5><p><strong>SMI Bajo:</strong> Riesgo de sarcopenia identificado. Implementación inmediata de entrenamiento de resistencia y optimización proteica.</p></div>';
            }
            if (resultados.grasaVisceral > 12) {
                alertasMedicas += '<div class="medical-alert high"><h5>🚨 Alerta Clínica</h5><p><strong>Grasa Visceral Elevada:</strong> Riesgo cardiometabólico aumentado. Protocolo de reducción urgente recomendado.</p></div>';
            }
            
            analisis += alertasMedicas + '</div>';
            
            document.getElementById('analisis').innerHTML = analisis;
            document.getElementById('resultados').style.display = 'block';
        }

        function getSarcopeniaStatus(smi, sexo) {
            var limite = sexo === 'hombre' ? 7.0 : 6.0;
            if (smi < limite) return 'RIESGO ALTO';
            if (smi < limite + 1) return 'RIESGO MODERADO';
            return 'NORMAL';
        }

        function getVisceralStatus(grasa) {
            if (grasa <= 8) return 'NORMAL';
            if (grasa <= 12) return 'MODERADO';
            return 'ALTO';
        }

        function getHomaStatus(homa) {
            if (homa < 2.0) return 'NORMAL';
            if (homa < 2.5) return 'LÍMITE';
            return 'RESISTENCIA';
        }

        function getIMCStatus(imc) {
            if (imc < 18.5) return 'BAJO PESO';
            if (imc < 25) return 'NORMAL';
            if (imc < 30) return 'SOBREPESO';
            return 'OBESIDAD';
        }

        function generarYEnviarPDF() {
            if (!resultados.nombre) {
                alert('⚠️ ERROR: Debe calcular el análisis primero');
                return;
            }

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                let y = 15;
                
                // HEADER PRINCIPAL
                doc.setFontSize(18);
                doc.setTextColor(44, 85, 48);
                doc.setFont('helvetica', 'bold');
                doc.text('POLANCO DIETETICS', 20, y);
                
                y += 8;
                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                doc.text('HOUSTON, TEXAS', 20, y);
                
                y += 6;
                doc.setFontSize(10);
                doc.text('CONSULTORÍA NUTRICIONAL ESPECIALIZADA', 20, y);
                
                y += 12;
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.text('ANÁLISIS NUTRICIONAL AVANZADO', 20, y);
                
                y += 8;
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text('Metodología Científica Polanco Dietetics | 24 Años de Experiencia Clínica', 20, y);
                
                y += 6;
                doc.text('Fecha: ' + new Date().toLocaleDateString() + ' | Reporte #: NUT-' + Math.floor(Math.random() * 10000), 20, y);
                
                y += 15;
                
                // INFORMACIÓN DEL PACIENTE
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.text('INFORMACIÓN DEL PACIENTE', 20, y);
                
                y += 8;
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text('Nombre: ' + resultados.nombre, 20, y);
                doc.text('Edad: ' + resultados.edad + ' años', 120, y);
                
                y += 6;
                doc.text('Email: ' + resultados.email, 20, y);
                doc.text('Sexo: ' + resultados.sexo, 120, y);
                
                y += 6;
                doc.text('Teléfono: ' + resultados.telefono, 20, y);
                doc.text('Peso: ' + resultados.peso + ' kg', 120, y);
                
                y += 15;
                
                // PLAN NUTRICIONAL
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.text('PLAN NUTRICIONAL PERSONALIZADO', 20, y);
                
                y += 10;
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                doc.text('CALORÍAS TOTALES: ' + resultados.calorias + ' kcal/día', 20, y);
                
                y += 8;
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                
                var macros = [
                    'Proteína: ' + resultados.proteinaG + 'g = ' + (resultados.proteinaG * 4) + ' kcal (' + Math.round((resultados.proteinaG * 4 / resultados.calorias) * 100) + '%)',
                    'Carbohidratos: ' + resultados.carbosG + 'g = ' + (resultados.carbosG * 4) + ' kcal (' + Math.round((resultados.carbosG * 4 / resultados.calorias) * 100) + '%)',
                    'Grasas: ' + resultados.grasasG + 'g = ' + Math.round(resultados.grasasG * 9) + ' kcal (' + Math.round((resultados.grasasG * 9 / resultados.calorias) * 100) + '%)',
                    'Hidratación: ' + resultados.hidratacion + ' ml diarios mínimo'
                ];
                
                for (let i = 0; i < macros.length; i++) {
                    doc.text('• ' + macros[i], 20, y);
                    y += 6;
                }
                
                var nombreArchivo = 'analisis-nutricional-' + resultados.nombre.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '') + '.pdf';
                doc.save(nombreArchivo);
                
                enviarEmail();
                
                alert('🎉 REPORTE GENERADO EXITOSAMENTE\n\nArchivo: ' + nombreArchivo + '\nInformación enviada a Polanco Dietetics');
                
            } catch (error) {
                console.error('Error:', error);
                alert('⚠️ ERROR: No se pudo generar el PDF. Intente nuevamente.');
            }
        }

        function enviarEmail() {
            var email = 'LEAD CALCULADORA NUTRICIONAL - POLANCO DIETETICS\n\n';
            email += 'INFORMACIÓN DEL PACIENTE:\n';
            email += 'Nombre: ' + resultados.nombre + '\n';
            email += 'Email: ' + resultados.email + '\n';
            email += 'Teléfono: ' + resultados.telefono + '\n';
            email += 'Edad: ' + resultados.edad + ' años\n';
            email += 'Sexo: ' + resultados.sexo + '\n';
            email += 'Peso: ' + resultados.peso + ' kg\n\n';
            
            email += 'RESULTADOS DEL ANÁLISIS:\n';
            email += 'Calorías: ' + resultados.calorias + ' kcal/día\n';
            email += 'Proteína: ' + resultados.proteinaG + 'g\n';
            email += 'Carbohidratos: ' + resultados.carbosG + 'g\n';
            email += 'Grasas: ' + resultados.grasasG + 'g\n';
            email += 'Hidratación: ' + resultados.hidratacion + ' ml\n\n';
            
            email += 'EVALUACIÓN CLÍNICA:\n';
            email += 'SMI: ' + resultados.smi + ' kg/m² - ' + getSarcopeniaStatus(resultados.smi, resultados.sexo) + '\n';
            email += 'Grasa Visceral: ' + resultados.grasaVisceral + ' - ' + getVisceralStatus(resultados.grasaVisceral) + '\n';
            email += 'IRS: ' + resultados.homaIR + ' - ' + getHomaStatus(resultados.homaIR) + '\n';
            email += 'IMC: ' + resultados.imc + ' kg/m²\n';
            email += 'Peso objetivo: ' + resultados.pesoObjetivo + ' kg\n\n';
            
            email += 'Fecha: ' + new Date().toLocaleString();
            email += '\nFuente: Calculadora Polanco Dietetics';
            
            var asunto = 'LEAD CALCULADORA - ' + resultados.nombre;
            var link = 'mailto:info@polancodietetics.com?subject=' + encodeURIComponent(asunto) + '&body=' + encodeURIComponent(email);
            window.open(link);
        }

        // Inicializar valores
        actualizarCarbs();
        actualizarProteina();
    </script>
</body>
</html>
